<!DOCTYPE html>
<html>
<head>
    <title>Bank Customer Churn Prediction</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Bank Customer Churn Prediction</h1>

        {% if not model_ready %}
        <div class="alert alert-warning">
            <p>The prediction model needs to be trained first.</p>
            <button class="btn btn-primary" id="trainButton">Train Model</button>
            <div id="trainingStatus" class="mt-2"></div>
        </div>
        {% else %}

        <form method="post" action="{% url 'predict' %}">
            {% csrf_token %}

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="credit_score" class="form-label">Кредитный рейтинг</label>
                    <input type="number" class="form-control" id="credit_score" name="credit_score"
                           min="0" max="1000" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="geography" class="form-label">Страна</label>
                    <select class="form-select" id="geography" name="geography" required>
                        {% for country in countries %}
                        <option value="{{ country }}">{{ country }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="gender" class="form-label">Пол</label>
                    <select class="form-select" id="gender" name="gender" required>
                        {% for gender in genders %}
                        <option value="{{ gender }}">{{ gender }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="age" class="form-label">Возраст</label>
                    <input type="number" class="form-control" id="age" name="age"
                           min="18" max="100" required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="tenure" class="form-label">Сколько лет клиент</label>
                    <input type="number" class="form-control" id="tenure" name="tenure"
                           min="1" max="82" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="balance" class="form-label">Баланс</label>
                    <input type="number" class="form-control" id="balance" name="balance"
                           min="0" step="0.01" required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="num_of_products" class="form-label">Кол-во продуктов</label>
                    <input type="number" class="form-control" id="num_of_products" name="num_of_products"
                           min="0" max="4" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="estimated_salary" class="form-label">Зарплата</label>
                    <input type="number" class="form-control" id="estimated_salary" name="estimated_salary"
                           min="0" step="0.01" required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="has_cr_card" name="has_cr_card">
                    <label class="form-check-label" for="has_cr_card">Есть кредитная карта</label>
                </div>

                <div class="col-md-6 mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="is_active_member" name="is_active_member">
                    <label class="form-check-label" for="is_active_member">Активный пользователь</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Предсказать</button>
        </form>
        {% endif %}
    </div>
{% if error_message %}
<div class="alert alert-danger">
    {{ error_message }}
</div>
{% endif %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const trainButton = document.getElementById('trainButton');
            if (trainButton) {
                trainButton.addEventListener('click', function() {
                    const statusDiv = document.getElementById('trainingStatus');
                    statusDiv.innerHTML = '<div class="alert alert-info">Training in progress... This may take a while.</div>';

                    fetch('/train/', {
                        method: 'GET'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            statusDiv.innerHTML = `<div class="alert alert-success">
                                Training completed with accuracy: ${(data.accuracy * 100).toFixed(2)}%
                                <br>Refreshing page...</div>`;
                            setTimeout(() => {
                                window.location.reload();
                            }, 3000);
                        } else {
                            statusDiv.innerHTML = `<div class="alert alert-danger">
                                Training failed: ${data.error}</div>`;
                        }
                    })
                    .catch(error => {
                        statusDiv.innerHTML = `<div class="alert alert-danger">
                            Error during training: ${error}</div>`;
                    });
                });
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>