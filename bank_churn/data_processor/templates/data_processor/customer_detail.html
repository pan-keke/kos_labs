{% extends 'base.html' %}{% block title %}{{ customer.surname }} - Детали клиента{% endblock %}{% block content %}<div class="row">    <div class="col-md-8">        <h1>Информация о клиенте: {{ customer.surname }}</h1>                <div class="card mb-4">            <div class="card-body">                <h5 class="card-title">Личная информация</h5>                <table class="table">                    <tr>                        <th>ID клиента:</th>                        <td>{{ customer.customer_id }}</td>                    </tr>                    <tr>                        <th>Регион:</th>                        <td>{{ customer.geography }}</td>                    </tr>                    <tr>                        <th>Пол:</th>                        <td>{{ customer.gender }}</td>                    </tr>                    <tr>                        <th>Возраст:</th>                        <td>{{ customer.age }}</td>                    </tr>                </table>            </div>        </div>        <div class="card mb-4">            <div class="card-body">                <h5 class="card-title">Информация о счете</h5>                <table class="table">                    <tr>                        <th>Кредитный рейтинг:</th>                        <td>{{ customer.creditscore }}</td>                    </tr>                    <tr>                        <th>Баланс:</th>                        <td>₽{{ customer.balance|floatformat:2 }}</td>                    </tr>                    <tr>                        <th>Продукты:</th>                        <td>{{ customer.numofproducts }}</td>                    </tr>                    <tr>                        <th>Срок обслуживания:</th>                        <td>{{ customer.tenure }} лет</td>                    </tr>                    <tr>                        <th>Кредитная карта:</th>                        <td>{% if customer.hascrcard %}Да{% else %}Нет{% endif %}</td>                    </tr>                    <tr>                        <th>Активный клиент:</th>                        <td>{% if customer.isactivemember %}Да{% else %}Нет{% endif %}</td>                    </tr>                    <tr>                        <th>Предполагаемая зарплата:</th>                        <td>₽{{ customer.estimatedsalary|floatformat:2 }}</td>                    </tr>                </table>            </div>        </div>    </div>

        <div class="col-md-4">        <div class="card mb-4">            <div class="card-body">                <h5 class="card-title">Анализ оттока</h5>                <button id="predict-churn" class="btn btn-primary mb-3" data-customer-id="{{ customer.pk }}">                    Рассчитать вероятность оттока                </button>                <div id="prediction-result" class="d-none">                    <div class="alert" role="alert"></div>                </div>                                {% if churn_predictions %}                <h6>Предыдущие предсказания</h6>                <ul class="list-group">                    {% for prediction in churn_predictions %}                    <li class="list-group-item">                        {{ prediction.prediction_date|date:"d.m.Y H:i" }}:                        {% if prediction.predicted_churn %}                        <span class="badge bg-danger">Высокий риск ({{ prediction.churn_probability|floatformat:2 }}%)</span>                        {% else %}                        <span class="badge bg-success">Низкий риск ({{ prediction.churn_probability|floatformat:2 }}%)</span>                        {% endif %}                    </li>                    {% endfor %}                </ul>                {% endif %}            </div>        </div>        <div class="card">            <div class="card-body">                <h5 class="card-title">Рекомендации</h5>                <button id="generate-recommendations" class="btn btn-success mb-3" data-customer-id="{{ customer.pk }}">                    Сформировать рекомендации                </button>                <div id="recommendations-result" class="d-none">                    <div class="alert" role="alert"></div>                </div>                {% if recommendations %}                <h6>Текущие рекомендации</h6>                <div class="list-group">                    {% for recommendation in recommendations %}                    <div class="list-group-item">                        <h6 class="mb-1">{{ recommendation.title }}</h6>                        <p class="mb-1">{{ recommendation.description }}</p>                        <small class="text-muted">Приоритет: {{ recommendation.priority }}</small>                    </div>                    {% endfor %}                </div>                {% endif %}            </div>        </div>    </div></div>
{% endblock %}

{% block extra_js %}<script>$(document).ready(function() {    $('#predict-churn').click(function() {        const customerId = $(this).data('customer-id');        const resultDiv = $('#prediction-result');        const alertDiv = resultDiv.find('.alert');                $.ajax({            url: `/churn/predict/${customerId}/`,            method: 'GET',            success: function(response) {                resultDiv.removeClass('d-none');                if (response.will_churn) {                    alertDiv.removeClass('alert-success').addClass('alert-danger')                        .html(`Высокий риск оттока (${response.probability.toFixed(2)}%)`);                } else {                    alertDiv.removeClass('alert-danger').addClass('alert-success')                        .html(`Низкий риск оттока (${response.probability.toFixed(2)}%)`);                }            },            error: function(xhr) {                resultDiv.removeClass('d-none');                alertDiv.removeClass('alert-success').addClass('alert-danger')                    .html('Ошибка при расчете вероятности оттока');            }        });    });    $('#generate-recommendations').click(function() {        const customerId = $(this).data('customer-id');        const resultDiv = $('#recommendations-result');        const alertDiv = resultDiv.find('.alert');                $.ajax({            url: `/recommendations/generate/${customerId}/`,            method: 'GET',            success: function(response) {                resultDiv.removeClass('d-none');                if (response.success) {                    let html = '<div class="list-group">';                    response.recommendations.forEach(function(rec) {                        html += `                            <div class="list-group-item">                                <h6 class="mb-1">${rec.title}</h6>                                <p class="mb-1">${rec.description}</p>                                <small class="text-muted">Приоритет: ${rec.priority}</small>                            </div>`;                    });                    html += '</div>';                    alertDiv.removeClass('alert-danger').addClass('alert-success').html(html);                } else {                    alertDiv.removeClass('alert-success').addClass('alert-danger')                        .html('Ошибка при формировании рекомендаций');                }            },            error: function(xhr) {                resultDiv.removeClass('d-none');                alertDiv.removeClass('alert-success').addClass('alert-danger')                    .html('Ошибка при формировании рекомендаций');            }        });    });});</script>{% endblock %} 