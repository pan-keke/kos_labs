{% extends 'base.html' %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è - –ê–Ω–∞–ª–∏–∑ –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–∞–Ω–∫–∞{% endblock %}

{% block extra_head %}
<style>
    @keyframes floatUp {
        0% {
            opacity: 0;
            transform: translateY(50px) scale(0.5);
        }
        70% {
            opacity: 1;
            transform: translateY(-150px) scale(1.2);
        }
        100% {
            opacity: 0;
            transform: translateY(-300px) scale(0.8);
        }
    }

    body {
        background: linear-gradient(to right, #fbc2eb, #a6c1ee);
    }

    .card {
        border-radius: 1rem;
        box-shadow: 0 0 30px rgba(255, 105, 180, 0.2);
        animation: fadeInUp 1s ease;
    }

    .card-header {
        background: linear-gradient(135deg, #ff5aad, #ff7eb3);
        color: white;
        text-align: center;
        border-top-left-radius: 1rem;
        border-top-right-radius: 1rem;
    }

    .btn-primary {
        background-color: #ff5aad;
        border: none;
    }

    .btn-secondary {
        background-color: #ffd1e8;
        color: #333;
        border: none;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animation-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
        animation: fadeIn 1.5s ease-in-out;
    }

    .emoji-burst {
        font-size: 2rem;
        animation: floatUp 4.5s ease-in-out forwards;
        position: absolute;
    }

    @keyframes floatUp {
        0% {
            opacity: 0;
            transform: translateY(50px) scale(0.5);
        }
        100% {
            opacity: 1;
            transform: translateY(-150px) scale(1.2);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
{% endblock %}

{% block content %}
<div class="position-relative">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card mt-4">
                <div class="card-header">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –æ—Ç—Ç–æ–∫–∞</h3>
                </div>
                <div class="card-body">
                    {% if prediction %}
                        <div id="result-message" class="alert {% if prediction.will_churn %}alert-danger{% else %}alert-success{% endif %} mb-4">
                            <h4 class="alert-heading">
                                {% if prediction.will_churn %}
                                –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –æ—Ç—Ç–æ–∫–∞
                                {% else %}
                                –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –æ—Ç—Ç–æ–∫–∞
                                {% endif %}
                            </h4>
                            <p class="mb-0">
                                –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç—Ç–æ–∫–∞: <strong>{{ prediction.probability|floatformat:2 }}%</strong>
                            </p>
                        </div>

                        <h5 class="mb-3">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h5>
                        <table class="table table-bordered">
                            <tr><th>–ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥:</th><td>{{ prediction.customer_data.creditscore }}</td></tr>
                            <tr><th>–†–µ–≥–∏–æ–Ω:</th><td>{{ prediction.customer_data.geography }}</td></tr>
                            <tr><th>–ü–æ–ª:</th><td>{{ prediction.customer_data.gender }}</td></tr>
                            <tr><th>–í–æ–∑—Ä–∞—Å—Ç:</th><td>{{ prediction.customer_data.age }}</td></tr>
                            <tr><th>–°—Ä–æ–∫ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (–≤ –≥–æ–¥–∞—Ö) :</th><td>{{ prediction.customer_data.tenure }} </td></tr>
                            <tr><th>–ë–∞–ª–∞–Ω—Å:</th><td>‚ÇΩ {{ prediction.customer_data.balance|floatformat:2 }}</td></tr>
                            <tr><th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:</th><td>{{ prediction.customer_data.numofproducts }}</td></tr>
                            <tr><th>–ï—Å—Ç—å –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞:</th><td>{% if prediction.customer_data.hascrcard %}–î–∞{% else %}–ù–µ—Ç{% endif %}</td></tr>
                            <tr><th>–ê–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç:</th><td>{% if prediction.customer_data.isactivemember %}–î–∞{% else %}–ù–µ—Ç{% endif %}</td></tr>
                            <tr><th>–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞:</th><td>‚ÇΩ{{ prediction.customer_data.estimatedsalary|floatformat:2 }}</td></tr>
                        </table>
                    {% else %}
                        <div class="alert alert-warning">
                            –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è.
                        </div>
                    {% endif %}

                    <div class="d-grid gap-2 mt-4">
                        <a href="{% url 'data_processor:input_form' %}" class="btn btn-primary">–°–¥–µ–ª–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ</a>
                        <a href="{% url 'data_processor:customer_list' %}" class="btn btn-secondary">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∫–ª–∏–µ–Ω—Ç–æ–≤</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if prediction %}
    <div id="animationOverlay" class="animation-overlay"></div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const prediction = {{ prediction.will_churn|yesno:"true,false" }};
    const overlay = document.getElementById("animationOverlay");

    if (!overlay) return;

    const emojis = prediction === true
        ? ["üò†", "üí¢", "üëø", "üñï", "üëé"]
        : ["üéâ", "üçì", "üçæ", "üå∏", "üíñ"];

    for (let i = 0; i < 20; i++) {
        let emoji = document.createElement("div");
        emoji.className = "emoji-burst";
        emoji.style.left = Math.random() * 90 + "%";
        emoji.style.top = Math.random() * 40 + 30 + "%";
        emoji.innerText = emojis[Math.floor(Math.random() * emojis.length)];

        // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
        emoji.addEventListener("animationend", () => emoji.remove());

        overlay.appendChild(emoji);
    }
});
</script>
{% endblock %}